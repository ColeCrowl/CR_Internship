<#
.SYNOPSIS
   Scrip automates outlook updates for windows and other security updates.

.NOTES
    Author          : Cole Crowl
    LinkedIn        : https://www.linkedin.com/in/colecrowl/
    GitHub          : https://github.com/ColeCrowl/ColeCrowl
    Date Created    : 2025-07-02
    Last Modified   : 2025-07-02
    Version         : 1.0
    CVEs            : N/A
    Plugin IDs      : N/A
    VM              : EnableCertPaddingCheck

.TESTED ON
    Date(s) Tested  : 2025-07-02
    Tested By       : Cole Crowl
    Systems Tested  : Windows 10 Pro 6.3
    PowerShell Ver. :  5.1.26100.4652 

.USAGE
    Put any usage instructions here.
    Example syntax:
    PS C:\> .\__remediation_template(SecurityUpdatesWindows).ps1 
#>


#
# PowerShell script to automatically trigger an Office Click-to-Run update.
# This is the command-line equivalent of clicking "Update Now" in the Office application.
# The script will locate the OfficeC2RClient.exe and execute the update process.
#
# IMPORTANT: This script should be run with Administrator privileges.
#

# --- Function to check for administrator privileges ---
function Test-AdminPrivileges {
    $isUserAdmin = (New-Object System.Security.Principal.WindowsPrincipal([System.Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole([System.Security.Principal.WindowsBuiltInRole]::Administrator)
    if (-not $isUserAdmin) {
        Write-Error "This script must be run with Administrator privileges. Please right-click PowerShell and select 'Run as Administrator'."
        return $false
    }
    return $true
}

# --- Main Script Logic ---
if (Test-AdminPrivileges) {
    Write-Host "Checking for Office Click-to-Run updates..."

    # Define the potential paths for the OfficeC2RClient.exe.
    $x64Path = "$env:ProgramFiles\Common Files\microsoft shared\ClickToRun\OfficeC2RClient.exe"
    $x86Path = "$env:ProgramFiles(x86)\Common Files\microsoft shared\ClickToRun\OfficeC2RClient.exe"

    $officeC2RClientPath = $null

    # Find the correct path to the executable.
    if (Test-Path $x64Path) {
        $officeC2RClientPath = $x64Path
        Write-Host "Found Office Click-to-Run client at '$x64Path'."
    } elseif (Test-Path $x86Path) {
        $officeC2RClientPath = $x86Path
        Write-Host "Found Office Click-to-Run client at '$x86Path'."
    } else {
        Write-Error "Could not find OfficeC2RClient.exe. This script is intended for Microsoft 365 or Click-to-Run installations. If you are using the new 'Outlook for Windows' app, it updates automatically."
        return
    }

    # Construct and execute the command.
    $arguments = "/update user displaylevel=True"
    Write-Host "Executing command: '$officeC2RClientPath $arguments'..."
    Start-Process -FilePath $officeC2RClientPath -ArgumentList $arguments -Wait -NoNewWindow

    Write-Host "`nUpdate process has been triggered. Please wait for the Office update window to appear and complete."
    Write-Host "The script will exit after the update process starts."
}
